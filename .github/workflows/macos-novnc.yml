name: macOS Safari (Browser Only)

on:
  workflow_dispatch:

jobs:
  macos:
    runs-on: macos-latest
    timeout-minutes: 360

    steps:
      - name: Enable Screen Sharing
        run: |
          sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart \
            -activate -configure -access -on \
            -restart -agent -privs -all

      - name: Set VNC Password
        run: |
          printf "password\npassword\n" | sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart \
            -configure -clientopts -setvnclegacy -vnclegacy yes \
            -setvncpw

      - name: Install noVNC + websockify (CORRECT METHOD)
          run: |
    brew install pipx
    pipx ensurepath
    pipx install websockify
    git clone https://github.com/novnc/noVNC.git ~/novnc
      - name: Start noVNC
        run: |
          nohup websockify --web ~/novnc 6080 localhost:5900 > novnc.log 2>&1 &

      - name: Install Cloudflare Tunnel (No Signup)
        run: |
          brew install cloudflared

      - name: Expose via Cloudflare Quick Tunnel
        run: |
          cloudflared tunnel --url http://localhost:6080
